<details> 
  <summary>Routing</summary>
  
# Traffic Manager Routing
https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-routing-methods
  
There are **six routing methods available**
1. Priority - use when you have 1 primary, 1 secondary location to route to
1. Weighted - load balance based on user-defined weights
1. Performance - geographic least latency / closest
1. Geographic - use for compliance w local laws. **Generally not recommended - use nested profiles instead**
1. Multivalue - returns multiple DNS entries to end user. Use if you want a customer to be able to choose IPv4/IPv6 endpoint for same resource (i.e. it gives option for both to end user)
1. Subnet - route specific users to specific endpoints

**What can TM route?** - anything on public internet; not usable within a vnet/private network

**Sticky sessions?** - this is DNS so no. Besides, th source IP received by TM is the Recursive DNS service, not the customer/end user

**What is a nested profile and why?**
  - MSFT recommends against Geographic routing and prefers nested routes [in this FAQ document](https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-faqs)
  - Why? 
      - A region can be assigned to only one endpoint within a profile if it is using the geographic routing method.
      - If that endpoint is unavailable, Traffic Manager does not failover to another endpoint 
      - Nested profiles mitigate this by allowing both geographic routing but multiple endpoints + auto failover
</details>


<details>
  <summary>Pricing & SKUs</summary>

</details>  

<details>
  <summary>Analytics and Real User Measurements</summary>
  
# Analytics and RUM
https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-faqs#real-user-measurements
 
**What is Real User Measurements?** - social latency; customers data tracked to speed up future queries

**What routing profiles support this?** - Only performance routing

**Where do I enable?** - Subscription level, not TM

**How?** - Embed javascript generated by TM into web app
 
</details>  

<details>
  <summary>Business Continuity / Auto Failover</summary>
  
**Can TM survive region failure?** - Yes. Your responsibility though to deploy the resources for the endpoints in multiple regions
  
# High Availability / DR / BC w Traffic Manager

https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-routing-methods#priority

Use **Priority Traffic-Routing Method**

> The Traffic Manager profile contains a prioritized list of service endpoints. **By default, Traffic Manager sends all traffic to the primary (highest-priority) endpoint** 
> **If the primary endpoint is not available, Traffic Manager routes the traffic to the second endpoint**
> If both the primary and secondary endpoints are not available, the traffic goes to the third, and so on. 
< Availability of the endpoint is based on the configured status (enabled or disabled) and the ongoing endpoint monitoring.

![x](https://docs.microsoft.com/en-us/azure/traffic-manager/media/traffic-manager-routing-methods/priority.png)
  
**Want to deploy 2 VMs - can TM auto-failover if one fails?** - Yes with a *failover routing policy*  
</details>  

<details>
  <summary>Endpoints</summary>
  
# Endpoints
https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-faqs#traffic-manager-endpoints
  
**What can I use - IP? DNS name?** - 3 thngs:
- CNAME that points to a DNS name w IPv4 (A record) or IPv6 (AAAA)
- IPv4 - must mark endpoint as **External**
- IPv6 - must mark endpoint as **External**
  
**Can I use Traffic Manager with endpoints from multiple subscriptions?** - No

**Can I use TM w deployment slots?** - Yes

**Does Traffic Manager support IPv6 endpoints?** - Yes, w a caveat. Traffic Manager does not currently provide IPv6-addressable *name servers* but, as long as the name server has IPv4 endpoint, the name server can return IPv6 to end user

**Healthcheck?** - https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-faqs#traffic-manager-endpoint-monitoring
- Portal, REST API, PowerShell, and Azure CLI
- Azure Monitor has graphical show

**Healthcheck use https?** - Yes but no cert. validation

**Healthcheck in header?** - Yes, https host headers defined at the profile level in TM

**Alert on healthcheck fail?** - Azure Monitor

</details>  


<details>
  <summary>Traffic View</summary>
  
# Traffic View
https://docs.microsoft.com/en-us/azure/traffic-manager/traffic-manager-faqs#traffic-view

**What?** - It uses the queries received by Traffic Manager and the network latency intelligence tables that the service maintains to provide you with the following:
- The **regions from** where your users are connecting to your endpoints in Azure.
- The **volume** of users connecting from these regions.
- The Azure **regions to** which they are getting routed to.
- Their **latency** experience to these Azure regions.
This information is available for you to consume through **geographical map** overlay and **tabular views** in the portal in addition to being available as **raw data** for you to download.

</details>  

<details>
  <summary>Misc</summary>
  
**Move - have existing TM and want to move {public IP, web app, app svc plan, etc}?** - Delete endpoints, move resource, add endpoint
  
**Resource groups and TM** - TM is global, not location-specific but it requires a resource group which is location-specific.
</details>  
